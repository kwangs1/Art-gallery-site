<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.admin.video">
	<resultMap id="videoResult" type="videoVO">
		<result property="vno" column="vno" />
		<result property="title" column="title" />
		<result property="note" column="note" />
		<result property="reg_id" column="reg_id" />
		<result property="movieFileName" column="movieFileName" />
		<result property="movieName" column="movieName" />
		<result property="regDate" column="regDate" />
	</resultMap>
	
<select id="selectVideoList" resultMap="videoResult"
		parameterType="java.util.Map">
			   select 
			   		  vno,
			          title,
			          note,
			          regDate
			       from (
			             select  vno,
			          			title,
			          			note,
			          			regDate,
			             	ROW_NUMBER() OVER(ORDER BY vno DESC) AS RNUM
			              from video_board 
		         where 1=1
		         	<include refid="search"></include>
		                       ) 
		WHERE RNUM BETWEEN #{rowStart} AND #{rowEnd}
		ORDER BY vno DESC		        

	</select>

		<select id="countList" resultType="Integer">
   		SELECT
    			count(*)
    		FROM
    			video_board
    		where 1=1
    			<include refid="search"></include>
    		and vno >0
	</select>
	
	<insert id="insertNewVideo" parameterType="java.util.Map">
		<selectKey resultType="String" keyProperty="vno"
			order="BEFORE">
			select seq_vno.nextval from dual
		</selectKey>
		<![CDATA[
		   insert into video_board(
		               					vno, 
                   						title,
										note,
										reg_id,
										movieFileName,					
										movieName,
										regDate
										)
					  			values(
					  			      #{vno},
					  			      #{title},
					  			      #{note},
					  			      #{reg_id},					  			     
					  			      #{movieFileName },
					  			      #{movieName},
					  			      #{regDate}
					 			 )
		]]>
	</insert>	
<sql id="search">
	<if test="searchType != null">
		<if test="searchType == 't'.toString()">and title like '%'|| #{keyword}||'%'</if>
		<if test="searchType == 'c'.toString()">and note like '%'|| #{keyword}||'%'</if>
		<if test="searchType == 'tc'.toString()">and (title like '%'|| #{keyword}||'%') or (note like '%'|| #{keyword}||'%')</if>
	</if>
</sql>
</mapper>